{% extends 'base.html' %}
{% load static %}

{% block content %}

    <nav class="navbar navbar-expand-md navbar-dark bg-dark py-3 nav_mod" style="background-image: url('{% static 'images/fondo_camarero.jpg' %}'); background-size: 100%">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'home' %}">
                <img src="{% static 'images/logo.png' %}" alt="Logo" width="150" height="150" style="border-radius: 20px">
            </a>
            <div></div>
            <div class="d-flex justify-content-center mt-3 mt-lg-0">
                <a href="{% url 'log_in_page' %}" class="btn btn-outline-light me-2 d-flex align-items-center">
                    <i class="bi bi-person-fill me-1"></i> CAMARERO
                </a>
            </div>
        </div>
        <div class="presentacion_mod">
            <h1>CAMARERO</h1>
        </div>
    </nav>


    <div class="ver_empleados">
        <h1>Gestión de pedidos:</h1>


        {% for pedido in pedidos %}
        <section class="pedido">
            <h2>Pedido nº {{ pedido.id }}</h2>
            <div class="ver_empleados_tabla">
                <div class="col">
                    <div class="ver_pedidos_titulo">
                    <h3>Nº mesa</h3>
                    <h3>Estado Mesa</h3>
                    <h3>Estado Pedido</h3>
                    <h3>Cobro</h3>
                </div>

                {% for linea in pedido.lineas.all %}
                <div class="row">
                    <div class="ver_empleados_row">
                        <div class="custom_row1">
                            <!-- Número de mesa -->
                            <p>{{ pedido.mesa.num_mesa }}</p>

                            <!-- Estado Mesa -->
                            {% for pedido in pedidos %}
                            {% if pedido.mesa %}
                                <form method="post" action="{% url 'actualizar_estado_mesa' pedido.mesa.num_mesa %}">
                                    {% csrf_token %}
                                    <select name="estado">
                                        {% for key, value in estados_mesa %}
                                            <option value="{{ key }}" {% if key == pedido.mesa.estado %}selected{% endif %}>{{ value }}</option>
                                        {% endfor %}
                                    </select>
                                    <button type="submit">Actualizar</button>
                                </form>
                                {% else %}
                                    <p>No hay mesa asignada para este pedido.</p>
                                {% endif %}
                            {% endfor %}

                            <!-- Mostrar el estado actual del pedido -->
                            <span class="badge
                                {% if linea.estado == 'pendiente' %}bg-warning
                                {% elif linea.estado == 'preparado' %}bg-success
                                {% else %}bg-secondary{% endif %}">
                                {{ linea.estado|capfirst }}
                            </span>

                            <!-- Botón generar cobro -->
                            <div>
                                {% if linea.estado == 'preparado' %}
                                    <button class="contenido_carrito_boton_enviar" onclick="document.getElementById('popout-{{ linea.id }}').style.display='flex'">PAGAR</button>
                                {% else %}
                                    -
                                {% endif %}
                            </div>

                            <!-- Popout individual por línea -->
                            <div id="popout-{{ linea.id }}" class="carrito_popout" style="display: none;">
                                <div class="carrito_popout_content">
                                    <h1>¡Pago Realizado <br> con Éxito!</h1>
                                    <img src="{% static 'images/tick_carrito.png' %}">
                                    <a href="{% url 'home' %}"><button class="contenido_carrito_boton_enviar">Volver</button></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                    <p>No hay líneas para este pedido.</p>
                {% endfor %}
            </div></div>
        </section>
        {% empty %}
            <p>No hay pedidos pendientes.</p>
        {% endfor %}
    </div>

{% endblock %}